local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local TweenInfo = TweenInfo.new
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer

local Icons = (function()
    local IconModule = {
        IconsType = "lucide",
        New = nil,
        IconThemeTag = nil,
        Icons = {
            ["lucide"] = {},
            ["craft"] = {},
            ["geist"] = {},
            ["sfsymbols"] = {},
        },
    }

    local function safeLoad(url)
        local success, result = pcall(function()
            return loadstring(game:HttpGet(url))()
        end)
        return success and result or {}
    end

    IconModule.Icons["lucide"] = safeLoad("https://raw.githubusercontent.com/Footagesus/Icons/refs/heads/main/lucide/dist/Icons.lua")
    IconModule.Icons["craft"] = safeLoad("https://raw.githubusercontent.com/Footagesus/Icons/refs/heads/main/craft/dist/Icons.lua")
    IconModule.Icons["geist"] = safeLoad("https://raw.githubusercontent.com/Footagesus/Icons/refs/heads/main/geist/dist/Icons.lua")
    IconModule.Icons["sfsymbols"] = safeLoad("https://raw.githubusercontent.com/Footagesus/Icons/refs/heads/main/sfsymbols/dist/Icons.lua")

    local function parseIconString(iconString)
        if type(iconString) == "string" then
            local splitIndex = iconString:find(":")
            if splitIndex then
                local iconType = iconString:sub(1, splitIndex - 1)
                local iconName = iconString:sub(splitIndex + 1)
                return iconType, iconName
            end
        end
        return nil, iconString
    end

    function IconModule.AddIcons(packName, iconsData)
        if type(packName) ~= "string" or type(iconsData) ~= "table" then
            error("AddIcons: packName must be string, iconsData must be table")
            return
        end
        
        if not IconModule.Icons[packName] then
            IconModule.Icons[packName] = { Icons = {}, Spritesheets = {} }
        end
        
        for iconName, iconValue in pairs(iconsData) do
            if type(iconValue) == "number" or (type(iconValue) == "string" and iconValue:match("^rbxassetid://")) then
                local imageId = type(iconValue) == "number" and "rbxassetid://" .. iconValue or iconValue
                IconModule.Icons[packName].Icons[iconName] = {
                    Image = imageId,
                    ImageRectSize = Vector2.new(0, 0),
                    ImageRectPosition = Vector2.new(0, 0),
                    Parts = nil
                }
                IconModule.Icons[packName].Spritesheets[imageId] = imageId
            elseif type(iconValue) == "table" and iconValue.Image then
                local imageId = type(iconValue.Image) == "number" and "rbxassetid://" .. iconValue.Image or iconValue.Image
                IconModule.Icons[packName].Icons[iconName] = {
                    Image = imageId,
                    ImageRectSize = iconValue.ImageRectSize or Vector2.new(0,0),
                    ImageRectPosition = iconValue.ImageRectPosition or Vector2.new(0,0),
                    Parts = iconValue.Parts
                }
                IconModule.Icons[packName].Spritesheets[imageId] = imageId
            end
        end
    end

    function IconModule.SetIconsType(iconType)
        IconModule.IconsType = iconType
    end

    function IconModule.Init(New, IconThemeTag)
        IconModule.New = New
        IconModule.IconThemeTag = IconThemeTag
        return IconModule
    end

    function IconModule.Icon(Icon, Type)
        local iconType, iconName = parseIconString(Icon)
        local targetType = iconType or Type or IconModule.IconsType
        local targetName = iconName or Icon

        local iconSet = IconModule.Icons[targetType]

        if not iconSet then return nil end

        if iconSet[targetName] and (type(iconSet[targetName]) == "string" or type(iconSet[targetName]) == "number") then
            local asset = type(iconSet[targetName]) == "number" and "rbxassetid://" .. iconSet[targetName] or iconSet[targetName]
            return { asset, { ImageRectSize = Vector2.new(0,0), ImageRectPosition = Vector2.new(0,0), Parts = nil } }
        end

        if iconSet.Icons and iconSet.Icons[targetName] then
            local data = iconSet.Icons[targetName]
            local imageId = type(data.Image) == "number" and "rbxassetid://" .. data.Image or data.Image
            return { iconSet.Spritesheets[imageId] or imageId, data }
        end

        return nil
    end

    function IconModule.Image(IconConfig)
        IconConfig = IconConfig or {}
        local Icon = {
            Icon = IconConfig.Icon or nil,
            Type = IconConfig.Type,
            Colors = IconConfig.Colors or { IconModule.IconThemeTag or Color3.new(1,1,1), Color3.new(1,1,1) },
            Size = IconConfig.Size or UDim2.new(0,24,0,24),
            IconFrame = nil,
        }

        local Colors = {}
        for i, color in ipairs(Icon.Colors) do
            Colors[i] = {
                ThemeTag = typeof(color) == "string" and color,
                Color = typeof(color) == "Color3" and color,
            }
        end

        local IconLabel = IconModule.Icon(Icon.Icon, Icon.Type)
        if not IconLabel then
            local fallback = Instance.new("ImageLabel")
            fallback.Size = Icon.Size
            fallback.BackgroundTransparency = 1
            if typeof(Icon.Icon) == "string" and Icon.Icon:match("^rbxassetid://") then
                fallback.Image = Icon.Icon
            end
            Icon.IconFrame = fallback
            return Icon
        end

        local image = type(IconLabel) == "table" and IconLabel[1] or IconLabel
        local data = type(IconLabel) == "table" and IconLabel[2] or { ImageRectSize = Vector2.new(0,0), ImageRectPosition = Vector2.new(0,0), Parts = nil }

        local frame = Instance.new("ImageLabel")
        frame.Size = Icon.Size
        frame.BackgroundTransparency = 1
        frame.ImageColor3 = Colors[1].Color or Color3.new(1,1,1)
        frame.Image = image
        frame.ImageRectSize = data.ImageRectSize
        frame.ImageRectOffset = data.ImageRectPosition

        if data.Parts then
            for i, partName in ipairs(data.Parts) do
                local part = IconModule.Icon(partName, Icon.Type)
                if part then
                    local p = Instance.new("ImageLabel")
                    p.Size = UDim2.new(1,0,1,0)
                    p.BackgroundTransparency = 1
                    p.ImageColor3 = Colors[1+i].Color or Color3.new(1,1,1)
                    p.Image = type(part) == "table" and part[1] or part
                    p.ImageRectSize = type(part) == "table" and part[2].ImageRectSize or Vector2.new(0,0)
                    p.ImageRectOffset = type(part) == "table" and part[2].ImageRectPosition or Vector2.new(0,0)
                    p.Parent = frame
                end
            end
        end

        Icon.IconFrame = frame
        return Icon
    end

    return IconModule
end)()

Icons.SetIconsType("lucide")

local Theme = {
    Background = Color3.fromRGB(20, 20, 20),
    Sidebar = Color3.fromRGB(25, 25, 25),
    Section = Color3.fromRGB(28, 28, 28),
    Text = Color3.fromRGB(240, 240, 240),
    TextDark = Color3.fromRGB(150, 150, 150),
    Accent = Color3.fromRGB(255, 105, 180),
    Border = Color3.fromRGB(45, 45, 45),
    Hover = Color3.fromRGB(35, 35, 35)
}

local Library = {
    Flags = {},
    Open = true,
    AccentColor = Theme.Accent,
    Keybind = Enum.KeyCode.RightControl
}

local CurrentKeybinds = {}
local Notifications = Instance.new("ScreenGui")
Notifications.Name = "RavinNotifications"
Notifications.Parent = CoreGui
Notifications.ZIndexBehavior = Enum.ZIndexBehavior.Global

local function MakeDraggable(topbarobject, object)
    local Dragging = nil
    local DragInput = nil
    local DragStart = nil
    local StartPosition = nil

    local function Update(input)
        local Delta = input.Position - DragStart
        local pos = UDim2.new(StartPosition.X.Scale, StartPosition.X.Offset + Delta.X, StartPosition.Y.Scale, StartPosition.Y.Offset + Delta.Y)
        TweenService:Create(object, TweenInfo.new(0.15), {Position = pos}):Play()
    end

    topbarobject.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Dragging = true
            DragStart = input.Position
            StartPosition = object.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    Dragging = false
                end
            end)
        end
    end)

    topbarobject.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            DragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == DragInput and Dragging then
            Update(input)
        end
    end)
end

function Library:Notify(title, text, duration)
    local Frame = Instance.new("Frame")
    Frame.Name = "Notification"
    Frame.Parent = Notifications
    Frame.BackgroundColor3 = Theme.Section
    Frame.BorderColor3 = Theme.Border
    Frame.BorderSizePixel = 1
    Frame.Size = UDim2.new(0, 250, 0, 70)
    Frame.Position = UDim2.new(1, 260, 1, -80)
    Frame.ClipsDescendants = true
    
    local Title = Instance.new("TextLabel")
    Title.Parent = Frame
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.new(0, 10, 0, 5)
    Title.Size = UDim2.new(1, -20, 0, 20)
    Title.Font = Enum.Font.Code
    Title.Text = title
    Title.TextColor3 = Theme.Accent
    Title.TextSize = 14
    Title.TextXAlignment = Enum.TextXAlignment.Left

    local Desc = Instance.new("TextLabel")
    Desc.Parent = Frame
    Desc.BackgroundTransparency = 1
    Desc.Position = UDim2.new(0, 10, 0, 25)
    Desc.Size = UDim2.new(1, -20, 0, 40)
    Desc.Font = Enum.Font.Gotham
    Desc.Text = text
    Desc.TextColor3 = Theme.Text
    Desc.TextSize = 12
    Desc.TextWrapped = true
    Desc.TextXAlignment = Enum.TextXAlignment.Left
    Desc.TextYAlignment = Enum.TextYAlignment.Top

    local Bar = Instance.new("Frame")
    Bar.Parent = Frame
    Bar.BackgroundColor3 = Theme.Accent
    Bar.BorderSizePixel = 0
    Bar.Position = UDim2.new(0, 0, 1, -2)
    Bar.Size = UDim2.new(1, 0, 0, 2)

    TweenService:Create(Frame, TweenInfo.new(0.5, Enum.EasingStyle.Quart), {Position = UDim2.new(1, -260, 1, -80)}):Play()
    TweenService:Create(Bar, TweenInfo.new(duration or 3, Enum.EasingStyle.Linear), {Size = UDim2.new(0, 0, 0, 2)}):Play()

    task.delay(duration or 3, function()
        local Out = TweenService:Create(Frame, TweenInfo.new(0.5, Enum.EasingStyle.Quart), {Position = UDim2.new(1, 260, 1, -80)})
        Out:Play()
        Out.Completed:Connect(function() Frame:Destroy() end)
    end)
end

function Library:CreateWindow(config)
    local Name = config.Name or "Ravion UI"
    local Icon = config.Icon or nil
    local Keybind = config.Keybind or Enum.KeyCode.RightControl
    local Size = config.Size or UDim2.new(0, 650, 0, 420)
    
    Library.Keybind = Keybind

    if LocalPlayer.PlayerGui:FindFirstChild("RavionUI") then
        LocalPlayer.PlayerGui.RavionUI:Destroy()
    end

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "RavionUI"
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    ScreenGui.ResetOnSpawn = false
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global

    local OpenBtn = Instance.new("TextButton")
    OpenBtn.Name = "MobileToggle"
    OpenBtn.Size = UDim2.new(0, 50, 0, 50)
    OpenBtn.Position = UDim2.new(0.1, 0, 0.1, 0)
    OpenBtn.BackgroundColor3 = Theme.Sidebar
    OpenBtn.BorderColor3 = Theme.Accent
    OpenBtn.BorderSizePixel = 1
    OpenBtn.Text = "UI"
    OpenBtn.TextColor3 = Theme.Accent
    OpenBtn.Font = Enum.Font.Code
    OpenBtn.TextSize = 14
    OpenBtn.Parent = ScreenGui
    OpenBtn.Visible = false

    if UserInputService.TouchEnabled then OpenBtn.Visible = true end
    MakeDraggable(OpenBtn, OpenBtn)

    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = Size
    MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    MainFrame.BackgroundColor3 = Theme.Background
    MainFrame.BorderColor3 = Theme.Border
    MainFrame.BorderSizePixel = 1
    MainFrame.Parent = ScreenGui
    MainFrame.ClipsDescendants = true

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 8)
    UICorner.Parent = MainFrame

    local Header = Instance.new("Frame")
    Header.Name = "Header"
    Header.Size = UDim2.new(1, 0, 0, 40)
    Header.BackgroundColor3 = Theme.Sidebar
    Header.BorderSizePixel = 0
    Header.Parent = MainFrame
    
    local HeaderCorner = Instance.new("UICorner")
    HeaderCorner.CornerRadius = UDim.new(0, 8)
    HeaderCorner.Parent = Header
    
    local HeaderCover = Instance.new("Frame")
    HeaderCover.Size = UDim2.new(1, 0, 0, 20)
    HeaderCover.Position = UDim2.new(0, 0, 1, -20)
    HeaderCover.BackgroundColor3 = Theme.Sidebar
    HeaderCover.BorderSizePixel = 0
    HeaderCover.Parent = Header
    
    MakeDraggable(Header, MainFrame)

    local WindowIconImg
    if Icon then
        WindowIconImg = Icons.Image({Icon = Icon, Size = UDim2.new(0, 28, 0, 28), Colors = {Theme.Accent}}).IconFrame
        WindowIconImg.Position = UDim2.new(0, 12, 0.5, -14)
        WindowIconImg.Parent = Header
    end

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, Icon and -100 or -60, 1, 0)
    Title.Position = UDim2.new(0, Icon and 50 or 12, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = Name
    Title.TextColor3 = Theme.Accent
    Title.TextSize = 18
    Title.Font = Enum.Font.GothamBold
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = Header

    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Size = UDim2.new(0, 40, 0, 40)
    CloseBtn.Position = UDim2.new(1, -40, 0, 0)
    CloseBtn.BackgroundTransparency = 1
    CloseBtn.Text = ""
    CloseBtn.Parent = Header
    
    local CloseIcon = Icons.Image({Icon = "lucide:x", Size = UDim2.new(0, 20, 0, 20), Colors = {Theme.TextDark}}).IconFrame
    CloseIcon.Position = UDim2.new(0.5, -10, 0.5, -10)
    CloseIcon.Parent = CloseBtn
    
    CloseBtn.MouseEnter:Connect(function()
        TweenService:Create(CloseIcon, TweenInfo.new(0.2), {ImageColor3 = Theme.Text}):Play()
    end)
    
    CloseBtn.MouseLeave:Connect(function()
        TweenService:Create(CloseIcon, TweenInfo.new(0.2), {ImageColor3 = Theme.TextDark}):Play()
    end)
    
    local function ToggleUI()
        Library.Open = not Library.Open
        MainFrame.Visible = Library.Open
        OpenBtn.Visible = not Library.Open and UserInputService.TouchEnabled
    end

    CloseBtn.MouseButton1Click:Connect(ToggleUI)
    OpenBtn.MouseButton1Click:Connect(ToggleUI)

    local SidebarContainer = Instance.new("Frame")
    SidebarContainer.Name = "SidebarContainer"
    SidebarContainer.Size = UDim2.new(0, 180, 1, -40)
    SidebarContainer.Position = UDim2.new(0, 0, 0, 40)
    SidebarContainer.BackgroundColor3 = Theme.Sidebar
    SidebarContainer.BorderSizePixel = 0
    SidebarContainer.Parent = MainFrame

    local UserFrame = Instance.new("Frame")
    UserFrame.Size = UDim2.new(1, 0, 0, 90)
    UserFrame.BackgroundTransparency = 1
    UserFrame.Parent = SidebarContainer

    local Avatar = Instance.new("ImageLabel")
    Avatar.Size = UDim2.new(0, 54, 0, 54)
    Avatar.Position = UDim2.new(0, 12, 0, 12)
    Avatar.BackgroundColor3 = Theme.Background
    Avatar.BorderSizePixel = 0
    Avatar.Parent = UserFrame

    local AvatarCorner = Instance.new("UICorner")
    AvatarCorner.CornerRadius = UDim.new(1, 0)
    AvatarCorner.Parent = Avatar

    local thumb, ready = pcall(function()
        return Players:GetUserThumbnailAsync(LocalPlayer.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size150x150)
    end)
    if ready then
        Avatar.Image = thumb
    end

    local DisplayNameLabel = Instance.new("TextLabel")
    DisplayNameLabel.Size = UDim2.new(1, -80, 0, 22)
    DisplayNameLabel.Position = UDim2.new(0, 76, 0, 14)
    DisplayNameLabel.BackgroundTransparency = 1
    DisplayNameLabel.Text = LocalPlayer.DisplayName
    DisplayNameLabel.TextColor3 = Theme.Text
    DisplayNameLabel.Font = Enum.Font.GothamBold
    DisplayNameLabel.TextSize = 14
    DisplayNameLabel.TextXAlignment = Enum.TextXAlignment.Left
    DisplayNameLabel.Parent = UserFrame

    local UsernameLabel = Instance.new("TextLabel")
    UsernameLabel.Size = UDim2.new(1, -80, 0, 18)
    UsernameLabel.Position = UDim2.new(0, 76, 0, 38)
    UsernameLabel.BackgroundTransparency = 1
    UsernameLabel.Text = "@" .. LocalPlayer.Name
    UsernameLabel.TextColor3 = Theme.TextDark
    UsernameLabel.Font = Enum.Font.Gotham
    UsernameLabel.TextSize = 12
    UsernameLabel.TextXAlignment = Enum.TextXAlignment.Left
    UsernameLabel.Parent = UserFrame

    local SearchBar = Instance.new("TextBox")
    SearchBar.Name = "SearchBar"
    SearchBar.Size = UDim2.new(1, -16, 0, 32)
    SearchBar.Position = UDim2.new(0, 8, 0, 96)
    SearchBar.BackgroundColor3 = Theme.Background
    SearchBar.BorderColor3 = Theme.Border
    SearchBar.BorderSizePixel = 1
    SearchBar.PlaceholderText = "Search..."
    SearchBar.Text = ""
    SearchBar.TextColor3 = Theme.Text
    SearchBar.PlaceholderColor3 = Theme.TextDark
    SearchBar.Font = Enum.Font.Gotham
    SearchBar.TextSize = 12
    SearchBar.Parent = SidebarContainer
    
    local SearchCorner = Instance.new("UICorner")
    SearchCorner.CornerRadius = UDim.new(0, 6)
    SearchCorner.Parent = SearchBar
    
    local SearchPad = Instance.new("UIPadding")
    SearchPad.PaddingLeft = UDim.new(0, 10)
    SearchPad.PaddingRight = UDim.new(0, 10)
    SearchPad.Parent = SearchBar

    local Sidebar = Instance.new("ScrollingFrame")
    Sidebar.Size = UDim2.new(1, 0, 1, -134)
    Sidebar.Position = UDim2.new(0, 0, 0, 134)
    Sidebar.BackgroundTransparency = 1
    Sidebar.BorderSizePixel = 0
    Sidebar.ScrollBarThickness = 3
    Sidebar.ScrollBarImageColor3 = Theme.Accent
    Sidebar.Parent = SidebarContainer

    local SidebarLayout = Instance.new("UIListLayout")
    SidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
    SidebarLayout.Padding = UDim.new(0, 6)
    SidebarLayout.Parent = Sidebar
    
    local SidebarPad = Instance.new("UIPadding")
    SidebarPad.PaddingLeft = UDim.new(0, 8)
    SidebarPad.PaddingRight = UDim.new(0, 8)
    SidebarPad.PaddingTop = UDim.new(0, 4)
    SidebarPad.Parent = Sidebar

    local ContentArea = Instance.new("Frame")
    ContentArea.Size = UDim2.new(1, -180, 1, -40)
    ContentArea.Position = UDim2.new(0, 180, 0, 40)
    ContentArea.BackgroundTransparency = 1
    ContentArea.ClipsDescendants = true
    ContentArea.Parent = MainFrame

    UserInputService.InputBegan:Connect(function(input, gp)
        if gp then return end
        if input.KeyCode == Library.Keybind then
            ToggleUI()
        end
    end)

    UserInputService.InputBegan:Connect(function(input, gp)
        if gp or not Library.Open then return end
        for key, callback in pairs(CurrentKeybinds) do
            if input.KeyCode == key then
                callback()
            end
        end
    end)

    local TabButtons = {}
    local TabData = {}
    
    local function SmartSearch(query)
        query = query:lower()
        
        if query == "" then
            for _, btn in pairs(TabButtons) do
                btn.Visible = true
            end
            return
        end
        
        local results = {}
        
        for tabName, data in pairs(TabData) do
            local score = 0
            local tabLower = tabName:lower()
            
            if tabLower:find(query, 1, true) then
                score = score + 100
            end
            
            for _, funcName in ipairs(data.functions) do
                local funcLower = funcName:lower()
                if funcLower:find(query, 1, true) then
                    score = score + 50
                end
            end
            
            if score > 0 then
                results[tabName] = score
            end
        end
        
        for _, btn in pairs(TabButtons) do
            if results[btn.Name] then
                btn.Visible = true
            else
                btn.Visible = false
            end
        end
    end
    
    SearchBar:GetPropertyChangedSignal("Text"):Connect(function()
        SmartSearch(SearchBar.Text)
    end)

    local Window = {}
    local FirstTab = true

    function Window:AddTab(config)
        local TabName = config.Name or "Tab"
        local Icon = config.Icon or nil
        local Description = config.Description or nil
        local Order = config.Order or #TabButtons + 1
        
        local TabBtn = Instance.new("TextButton")
        TabBtn.Name = TabName
        TabBtn.Size = UDim2.new(1, 0, 0, 38)
        TabBtn.BackgroundColor3 = Theme.Sidebar
        TabBtn.Text = ""
        TabBtn.BorderSizePixel = 0
        TabBtn.LayoutOrder = Order
        TabBtn.AutoButtonColor = false
        TabBtn.Parent = Sidebar
        
        local TabCorner = Instance.new("UICorner")
        TabCorner.CornerRadius = UDim.new(0, 6)
        TabCorner.Parent = TabBtn
        
        local TabBtnIcon
        if Icon then
            TabBtnIcon = Icons.Image({Icon = Icon, Size = UDim2.new(0, 22, 0, 22), Colors = {Theme.TextDark}}).IconFrame
            TabBtnIcon.Position = UDim2.new(0, 12, 0.5, -11)
            TabBtnIcon.Parent = TabBtn
        end
        
        local TabLabel = Instance.new("TextLabel")
        TabLabel.Size = UDim2.new(1, Icon and -46 or -20, 1, 0)
        TabLabel.Position = UDim2.new(0, Icon and 42 or 12, 0, 0)
        TabLabel.BackgroundTransparency = 1
        TabLabel.Text = TabName
        TabLabel.TextColor3 = Theme.TextDark
        TabLabel.Font = Enum.Font.GothamSemibold
        TabLabel.TextSize = 13
        TabLabel.TextXAlignment = Enum.TextXAlignment.Left
        TabLabel.Parent = TabBtn
        
        table.insert(TabButtons, TabBtn)
        TabData[TabName] = {functions = {}}

        local Page = Instance.new("ScrollingFrame")
        Page.Size = UDim2.new(1, -8, 1, 0)
        Page.Position = UDim2.new(0, 4, 0, 0)
        Page.BackgroundTransparency = 1
        Page.ScrollBarThickness = 4
        Page.ScrollBarImageColor3 = Theme.Accent
        Page.Visible = false
        Page.BorderSizePixel = 0
        Page.Parent = ContentArea

        local TabHeader = Instance.new("Frame")
        TabHeader.Size = UDim2.new(1, 0, 0, Description and 90 or 60)
        TabHeader.BackgroundTransparency = 1
        TabHeader.Parent = Page

        local PageTabIcon
        if Icon then
            PageTabIcon = Icons.Image({Icon = Icon, Size = UDim2.new(0, 40, 0, 40), Colors = {Theme.Accent}}).IconFrame
            PageTabIcon.Position = UDim2.new(0, 12, 0, Description and 20 or 10)
            PageTabIcon.Parent = TabHeader
        end

        local PageTitle = Instance.new("TextLabel")
        PageTitle.Size = UDim2.new(1, Icon and -70 or -24, 0, 32)
        PageTitle.Position = UDim2.new(0, Icon and 62 or 12, 0, 10)
        PageTitle.BackgroundTransparency = 1
        PageTitle.Text = TabName
        PageTitle.TextColor3 = Theme.Accent
        PageTitle.Font = Enum.Font.GothamBold
        PageTitle.TextSize = 22
        PageTitle.TextXAlignment = Enum.TextXAlignment.Left
        PageTitle.Parent = TabHeader

        if Description then
            local PageDesc = Instance.new("TextLabel")
            PageDesc.Size = UDim2.new(1, Icon and -70 or -24, 0, 22)
            PageDesc.Position = UDim2.new(0, Icon and 62 or 12, 0, 52)
            PageDesc.BackgroundTransparency = 1
            PageDesc.Text = Description
            PageDesc.TextColor3 = Theme.TextDark
            PageDesc.Font = Enum.Font.Gotham
            PageDesc.TextSize = 13
            PageDesc.TextWrapped = true
            PageDesc.TextXAlignment = Enum.TextXAlignment.Left
            PageDesc.Parent = TabHeader
        end

        local ColumnsContainer = Instance.new("Frame")
        ColumnsContainer.Size = UDim2.new(1, 0, 1, 0)
        ColumnsContainer.Position = UDim2.new(0, 0, 0, Description and 90 or 60)
        ColumnsContainer.BackgroundTransparency = 1
        ColumnsContainer.Parent = Page

        local LeftColumn = Instance.new("Frame")
        LeftColumn.Size = UDim2.new(0.5, -6, 1, 0)
        LeftColumn.BackgroundTransparency = 1
        LeftColumn.Parent = ColumnsContainer

        local LeftLayout = Instance.new("UIListLayout")
        LeftLayout.Padding = UDim.new(0, 10)
        LeftLayout.SortOrder = Enum.SortOrder.LayoutOrder
        LeftLayout.Parent = LeftColumn

        local RightColumn = Instance.new("Frame")
        RightColumn.Size = UDim2.new(0.5, -6, 1, 0)
        RightColumn.Position = UDim2.new(0.5, 12, 0, 0)
        RightColumn.BackgroundTransparency = 1
        RightColumn.Parent = ColumnsContainer

        local RightLayout = Instance.new("UIListLayout")
        RightLayout.Padding = UDim.new(0, 10)
        RightLayout.SortOrder = Enum.SortOrder.LayoutOrder
        RightLayout.Parent = RightColumn

        if FirstTab then
            Page.Visible = true
            TabBtn.BackgroundColor3 = Theme.Background
            TabLabel.TextColor3 = Theme.Text
            if TabBtnIcon then
                TabBtnIcon.ImageColor3 = Theme.Accent
            end
            FirstTab = false
        end

        TabBtn.MouseButton1Click:Connect(function()
            for _, child in pairs(ContentArea:GetChildren()) do 
                if child:IsA("ScrollingFrame") then 
                    child.Visible = false 
                end 
            end
            for _, btn in pairs(TabButtons) do
                TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Sidebar}):Play()
                local lbl = btn:FindFirstChildWhichIsA("TextLabel")
                if lbl then
                    TweenService:Create(lbl, TweenInfo.new(0.2), {TextColor3 = Theme.TextDark}):Play()
                end
                local icon = btn:FindFirstChildWhichIsA("ImageLabel")
                if icon then
                    TweenService:Create(icon, TweenInfo.new(0.2), {ImageColor3 = Theme.TextDark}):Play()
                end
            end
            Page.Visible = true
            TweenService:Create(TabBtn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Background}):Play()
            TweenService:Create(TabLabel, TweenInfo.new(0.2), {TextColor3 = Theme.Text}):Play()
            if TabBtnIcon then
                TweenService:Create(TabBtnIcon, TweenInfo.new(0.2), {ImageColor3 = Theme.Accent}):Play()
            end
        end)

        local Tab = {}

        function Tab:AddGroupbox(config)
            local GroupName = config.Name or "Groupbox"
            local Icon = config.Icon or nil
            local Side = config.Side and config.Side:lower() or "left"
            
            local targetColumn = Side == "right" and RightColumn or LeftColumn
            
            table.insert(TabData[TabName].functions, GroupName:upper())

            local Groupbox = Instance.new("Frame")
            Groupbox.BackgroundColor3 = Theme.Section
            Groupbox.BorderColor3 = Theme.Border
            Groupbox.BorderSizePixel = 1
            Groupbox.Size = UDim2.new(1, 0, 0, 50)
            Groupbox.Parent = targetColumn
            
            local GroupCorner = Instance.new("UICorner")
            GroupCorner.CornerRadius = UDim.new(0, 6)
            GroupCorner.Parent = Groupbox

            local hasIcon = Icon ~= nil
            local GroupIconImg
            if hasIcon then
                GroupIconImg = Icons.Image({Icon = Icon, Size = UDim2.new(0, 20, 0, 20), Colors = {Theme.Accent}}).IconFrame
                GroupIconImg.Position = UDim2.new(0, 12, 0, 8)
                GroupIconImg.Parent = Groupbox
            end

            local GroupTitle = Instance.new("TextLabel")
            GroupTitle.BackgroundTransparency = 1
            GroupTitle.Position = UDim2.new(0, hasIcon and 40 or 12, 0, 6)
            GroupTitle.Size = UDim2.new(1, hasIcon and -52 or -24, 0, 20)
            GroupTitle.Text = GroupName:upper()
            GroupTitle.TextColor3 = Theme.Accent
            GroupTitle.Font = Enum.Font.Code
            GroupTitle.TextSize = 12
            GroupTitle.TextXAlignment = Enum.TextXAlignment.Left
            GroupTitle.Parent = Groupbox

            local ContentLayout = Instance.new("UIListLayout")
            ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
            ContentLayout.Padding = UDim.new(0, 4)
            ContentLayout.Parent = Groupbox

            local ContentPad = Instance.new("UIPadding")
            ContentPad.PaddingTop = UDim.new(0, 32)
            ContentPad.PaddingLeft = UDim.new(0, 10)
            ContentPad.PaddingRight = UDim.new(0, 10)
            ContentPad.PaddingBottom = UDim.new(0, 10)
            ContentPad.Parent = Groupbox

            ContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                Groupbox.Size = UDim2.new(1, 0, 0, ContentLayout.AbsoluteContentSize.Y + 42)
            end)

            local Group = {}

            function Group:AddLabel(config)
                local Text = config.Text or "Label"
                
                table.insert(TabData[TabName].functions, "Label: " .. Text)
                
                local Label = Instance.new("TextLabel")
                Label.Size = UDim2.new(1, 0, 0, 20)
                Label.BackgroundTransparency = 1
                Label.Text = Text
                Label.TextColor3 = Theme.TextDark
                Label.Font = Enum.Font.Gotham
                Label.TextSize = 12
                Label.TextXAlignment = Enum.TextXAlignment.Left
                Label.Parent = Groupbox
                
                local LabelObj = {}
                function LabelObj:Set(newText)
                    Label.Text = newText
                end
                return LabelObj
            end
            
            function Group:AddParagraph(config)
                local Title = config.Title or "Paragraph"
                local Content = config.Content or ""
                
                table.insert(TabData[TabName].functions, "Paragraph: " .. Title)
                
                local ParaFrame = Instance.new("Frame")
                ParaFrame.Size = UDim2.new(1, 0, 0, 0)
                ParaFrame.BackgroundTransparency = 1
                ParaFrame.Parent = Groupbox
                
                local PTitle = Instance.new("TextLabel")
                PTitle.Size = UDim2.new(1, 0, 0, 16)
                PTitle.BackgroundTransparency = 1
                PTitle.Text = Title
                PTitle.TextColor3 = Theme.Text
                PTitle.Font = Enum.Font.GothamBold
                PTitle.TextSize = 12
                PTitle.TextXAlignment = Enum.TextXAlignment.Left
                PTitle.Parent = ParaFrame
                
                local PContent = Instance.new("TextLabel")
                PContent.Position = UDim2.new(0, 0, 0, 18)
                PContent.Size = UDim2.new(1, 0, 0, 0)
                PContent.BackgroundTransparency = 1
                PContent.Text = Content
                PContent.TextColor3 = Theme.TextDark
                PContent.Font = Enum.Font.Gotham
                PContent.TextSize = 12
                PContent.TextWrapped = true
                PContent.TextXAlignment = Enum.TextXAlignment.Left
                PContent.TextYAlignment = Enum.TextYAlignment.Top
                PContent.Parent = ParaFrame
                
                PContent.Size = UDim2.new(1, 0, 0, PContent.TextBounds.Y + 4)
                ParaFrame.Size = UDim2.new(1, 0, 0, PContent.TextBounds.Y + 22)
            end

            function Group:AddButton(config)
                local Text = config.Text or "Button"
                local Callback = config.Callback or function() end
                
                table.insert(TabData[TabName].functions, "Button: " .. Text)
                
                local Button = Instance.new("TextButton")
                Button.Size = UDim2.new(1, 0, 0, 32)
                Button.BackgroundColor3 = Theme.Background
                Button.BorderColor3 = Theme.Border
                Button.BorderSizePixel = 1
                Button.Text = Text
                Button.TextColor3 = Theme.Text
                Button.Font = Enum.Font.Gotham
                Button.TextSize = 12
                Button.AutoButtonColor = false
                Button.Parent = Groupbox
                
                local BtnCorner = Instance.new("UICorner")
                BtnCorner.CornerRadius = UDim.new(0, 4)
                BtnCorner.Parent = Button

                Button.MouseEnter:Connect(function()
                    TweenService:Create(Button, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Hover}):Play()
                end)

                Button.MouseLeave:Connect(function()
                    TweenService:Create(Button, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Background}):Play()
                end)

                Button.MouseButton1Click:Connect(function()
                    pcall(Callback)
                    local ripple = Instance.new("Frame")
                    ripple.BackgroundColor3 = Theme.Accent
                    ripple.BackgroundTransparency = 0.6
                    ripple.BorderSizePixel = 0
                    ripple.AnchorPoint = Vector2.new(0.5, 0.5)
                    ripple.Position = UDim2.new(0.5, 0, 0.5, 0)
                    ripple.Size = UDim2.new(0, 0, 0, 0)
                    ripple.Parent = Button
                    
                    local ripCorner = Instance.new("UICorner")
                    ripCorner.CornerRadius = UDim.new(1, 0)
                    ripCorner.Parent = ripple
                    
                    local t = TweenService:Create(ripple, TweenInfo.new(0.4), {Size = UDim2.new(1.2, 0, 1.2, 0), BackgroundTransparency = 1})
                    t:Play()
                    t.Completed:Connect(function() ripple:Destroy() end)
                end)
            end

            function Group:AddToggle(config)
                local Text = config.Text or "Toggle"
                local Default = config.Default or false
                local Flag = config.Flag or nil
                local Callback = config.Callback or function() end
                
                table.insert(TabData[TabName].functions, "Toggle: " .. Text)
                
                local toggled = Default
                
                local ToggleFrame = Instance.new("TextButton")
                ToggleFrame.Size = UDim2.new(1, 0, 0, 28)
                ToggleFrame.BackgroundTransparency = 1
                ToggleFrame.Text = ""
                ToggleFrame.Parent = Groupbox

                local Label = Instance.new("TextLabel")
                Label.Size = UDim2.new(1, -30, 1, 0)
                Label.BackgroundTransparency = 1
                Label.Text = Text
                Label.TextColor3 = Theme.Text
                Label.Font = Enum.Font.Gotham
                Label.TextSize = 12
                Label.TextXAlignment = Enum.TextXAlignment.Left
                Label.Parent = ToggleFrame

                local Box = Instance.new("Frame")
                Box.Size = UDim2.new(0, 18, 0, 18)
                Box.Position = UDim2.new(1, -20, 0.5, -9)
                Box.BackgroundColor3 = Theme.Background
                Box.BorderColor3 = Theme.Border
                Box.BorderSizePixel = 1
                Box.Parent = ToggleFrame
                
                local BoxCorner = Instance.new("UICorner")
                BoxCorner.CornerRadius = UDim.new(0, 3)
                BoxCorner.Parent = Box

                local Indicator = Instance.new("Frame")
                Indicator.Size = UDim2.new(1, -4, 1, -4)
                Indicator.Position = UDim2.new(0, 2, 0, 2)
                Indicator.BackgroundColor3 = Theme.Accent
                Indicator.BorderSizePixel = 0
                Indicator.BackgroundTransparency = 1
                Indicator.Parent = Box
                
                local IndCorner = Instance.new("UICorner")
                IndCorner.CornerRadius = UDim.new(0, 2)
                IndCorner.Parent = Indicator

                local function UpdateState(state)
                    toggled = state
                    if Flag then Library.Flags[Flag] = toggled end
                    pcall(Callback, toggled)
                    
                    if toggled then
                        TweenService:Create(Indicator, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
                        TweenService:Create(Box, TweenInfo.new(0.2), {BorderColor3 = Theme.Accent}):Play()
                    else
                        TweenService:Create(Indicator, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
                        TweenService:Create(Box, TweenInfo.new(0.2), {BorderColor3 = Theme.Border}):Play()
                    end
                end

                ToggleFrame.MouseButton1Click:Connect(function()
                    UpdateState(not toggled)
                end)

                if Default then UpdateState(true) end
                
                local ToggleObj = {}
                function ToggleObj:Set(state)
                    UpdateState(state)
                end
                return ToggleObj
            end

            function Group:AddSlider(config)
                local Text = config.Text or "Slider"
                local Min = config.Min or 0
                local Max = config.Max or 100
                local Default = config.Default or Min
                local Increment = config.Increment or 1
                local Flag = config.Flag or nil
                local Callback = config.Callback or function() end
                
                table.insert(TabData[TabName].functions, "Slider: " .. Text)
                
                local currentValue = Default

                local SliderFrame = Instance.new("Frame")
                SliderFrame.Size = UDim2.new(1, 0, 0, 42)
                SliderFrame.BackgroundTransparency = 1
                SliderFrame.Parent = Groupbox

                local Label = Instance.new("TextLabel")
                Label.Size = UDim2.new(0.65, 0, 0, 16)
                Label.BackgroundTransparency = 1
                Label.Text = Text
                Label.TextColor3 = Theme.Text
                Label.Font = Enum.Font.Gotham
                Label.TextSize = 12
                Label.TextXAlignment = Enum.TextXAlignment.Left
                Label.Parent = SliderFrame
                
                local ValueBox = Instance.new("TextBox")
                ValueBox.Size = UDim2.new(0.35, 0, 0, 16)
                ValueBox.Position = UDim2.new(0.65, 0, 0, 0)
                ValueBox.BackgroundTransparency = 1
                ValueBox.Text = tostring(currentValue)
                ValueBox.TextColor3 = Theme.Accent
                ValueBox.Font = Enum.Font.GothamBold
                ValueBox.TextSize = 12
                ValueBox.TextXAlignment = Enum.TextXAlignment.Right
                ValueBox.Parent = SliderFrame

                local BarFrame = Instance.new("Frame")
                BarFrame.Size = UDim2.new(1, 0, 0, 10)
                BarFrame.Position = UDim2.new(0, 0, 0, 24)
                BarFrame.BackgroundColor3 = Theme.Background
                BarFrame.BorderColor3 = Theme.Border
                BarFrame.BorderSizePixel = 1
                BarFrame.Parent = SliderFrame
                
                local BarCorner = Instance.new("UICorner")
                BarCorner.CornerRadius = UDim.new(1, 0)
                BarCorner.Parent = BarFrame

                local Fill = Instance.new("Frame")
                local ratio = (Default - Min) / (Max - Min)
                Fill.Size = UDim2.new(ratio, 0, 1, 0)
                Fill.BackgroundColor3 = Theme.Accent
                Fill.BorderSizePixel = 0
                Fill.Parent = BarFrame
                
                local FillCorner = Instance.new("UICorner")
                FillCorner.CornerRadius = UDim.new(1, 0)
                FillCorner.Parent = Fill

                local function SetValue(val)
                    currentValue = math.clamp(val, Min, Max)
                    local currentRatio = (currentValue - Min) / (Max - Min)
                    
                    TweenService:Create(Fill, TweenInfo.new(0.1), {Size = UDim2.new(currentRatio, 0, 1, 0)}):Play()
                    ValueBox.Text = tostring(currentValue)
                    
                    if Flag then Library.Flags[Flag] = currentValue end
                    pcall(Callback, currentValue)
                end

                local dragging = false
                local function updateInput(input)
                    local barWidth = BarFrame.AbsoluteSize.X
                    local pos = math.clamp(input.Position.X - BarFrame.AbsolutePosition.X, 0, barWidth)
                    local newRatio = pos / barWidth
                    local rawValue = Min + newRatio * (Max - Min)
                    local steppedValue = math.floor(rawValue / Increment + 0.5) * Increment
                    SetValue(steppedValue)
                end
                
                ValueBox.FocusLost:Connect(function()
                    local n = tonumber(ValueBox.Text)
                    if n then SetValue(n) else ValueBox.Text = tostring(currentValue) end
                end)

                BarFrame.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then 
                        dragging = true
                        updateInput(input) 
                    end
                end)
                
                UserInputService.InputChanged:Connect(function(input)
                    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                        updateInput(input)
                    end
                end)
                
                UserInputService.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then 
                        dragging = false 
                    end
                end)

                if Flag then Library.Flags[Flag] = currentValue end
                
                local SliderObj = {}
                function SliderObj:Set(val)
                    SetValue(val)
                end
                return SliderObj
            end

            function Group:AddTextbox(config)
                local Placeholder = config.Placeholder or "Enter text..."
                local Flag = config.Flag or nil
                local Callback = config.Callback or function() end
                
                table.insert(TabData[TabName].functions, "Textbox: " .. Placeholder)
                
                local BoxFrame = Instance.new("Frame")
                BoxFrame.Size = UDim2.new(1, 0, 0, 32)
                BoxFrame.BackgroundColor3 = Theme.Background
                BoxFrame.BorderColor3 = Theme.Border
                BoxFrame.BorderSizePixel = 1
                BoxFrame.Parent = Groupbox
                
                local BoxCorner = Instance.new("UICorner")
                BoxCorner.CornerRadius = UDim.new(0, 4)
                BoxCorner.Parent = BoxFrame

                local TextBox = Instance.new("TextBox")
                TextBox.Size = UDim2.new(1, -16, 1, -4)
                TextBox.Position = UDim2.new(0, 8, 0, 2)
                TextBox.BackgroundTransparency = 1
                TextBox.Text = ""
                TextBox.PlaceholderText = Placeholder
                TextBox.PlaceholderColor3 = Theme.TextDark
                TextBox.TextColor3 = Theme.Text
                TextBox.Font = Enum.Font.Gotham
                TextBox.TextSize = 12
                TextBox.TextXAlignment = Enum.TextXAlignment.Left
                TextBox.Parent = BoxFrame
                
                local function SetText(txt)
                    TextBox.Text = txt
                    if Flag then Library.Flags[Flag] = txt end
                    pcall(Callback, txt)
                end
                
                TextBox.FocusLost:Connect(function()
                    SetText(TextBox.Text)
                end)
                
                local TextboxObj = {}
                function TextboxObj:Set(txt)
                    SetText(txt)
                end
                return TextboxObj
            end

            function Group:AddDropdown(config)
                local Text = config.Text or "Dropdown"
                local Options = config.Options or {"Option 1"}
                local Default = config.Default or Options[1]
                local Flag = config.Flag or nil
                local Callback = config.Callback or function() end
                
                table.insert(TabData[TabName].functions, "Dropdown: " .. Text)
                
                local selected = Default
                local isExpanded = false

                local DropdownFrame = Instance.new("Frame")
                DropdownFrame.Size = UDim2.new(1, 0, 0, 28)
                DropdownFrame.BackgroundTransparency = 1
                DropdownFrame.Parent = Groupbox

                local Label = Instance.new("TextLabel")
                Label.Size = UDim2.new(0.4, 0, 1, 0)
                Label.BackgroundTransparency = 1
                Label.Text = Text
                Label.TextColor3 = Theme.Text
                Label.Font = Enum.Font.Gotham
                Label.TextSize = 12
                Label.TextXAlignment = Enum.TextXAlignment.Left
                Label.Parent = DropdownFrame

                local ClickableFrame = Instance.new("TextButton")
                ClickableFrame.Size = UDim2.new(0.6, 0, 1, 0)
                ClickableFrame.Position = UDim2.new(0.4, 0, 0, 0)
                ClickableFrame.BackgroundColor3 = Theme.Background
                ClickableFrame.BorderColor3 = Theme.Border
                ClickableFrame.BorderSizePixel = 1
                ClickableFrame.Text = ""
                ClickableFrame.AutoButtonColor = false
                ClickableFrame.Parent = DropdownFrame
                
                local ClickCorner = Instance.new("UICorner")
                ClickCorner.CornerRadius = UDim.new(0, 4)
                ClickCorner.Parent = ClickableFrame

                local SelectionText = Instance.new("TextLabel")
                SelectionText.Size = UDim2.new(1, -30, 1, 0)
                SelectionText.Position = UDim2.new(0, 8, 0, 0)
                SelectionText.BackgroundTransparency = 1
                SelectionText.Text = selected
                SelectionText.TextColor3 = Theme.Accent
                SelectionText.Font = Enum.Font.Gotham
                SelectionText.TextSize = 12
                SelectionText.TextXAlignment = Enum.TextXAlignment.Left
                SelectionText.TextTruncate = Enum.TextTruncate.AtEnd
                SelectionText.Parent = ClickableFrame
                
                local ArrowIcon = Icons.Image({Icon = "lucide:chevron-down", Size = UDim2.new(0, 16, 0, 16), Colors = {Theme.TextDark}}).IconFrame
                ArrowIcon.Position = UDim2.new(1, -22, 0.5, -8)
                ArrowIcon.Parent = ClickableFrame

                local DropdownList = Instance.new("ScrollingFrame")
                DropdownList.Size = UDim2.new(0.6, 0, 0, 0)
                DropdownList.Position = UDim2.new(0.4, 0, 1, 4)
                DropdownList.BackgroundColor3 = Theme.Section
                DropdownList.BorderColor3 = Theme.Border
                DropdownList.BorderSizePixel = 1
                DropdownList.Visible = false
                DropdownList.ScrollBarThickness = 2
                DropdownList.Parent = DropdownFrame
                
                local ListCorner = Instance.new("UICorner")
                ListCorner.CornerRadius = UDim.new(0, 4)
                ListCorner.Parent = DropdownList

                local ListLayout = Instance.new("UIListLayout")
                ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
                ListLayout.Parent = DropdownList
                
                local function SetOption(opt)
                    selected = opt
                    SelectionText.Text = opt
                    if Flag then Library.Flags[Flag] = opt end
                    pcall(Callback, opt)
                    
                    isExpanded = false
                    DropdownList.Visible = false
                    TweenService:Create(ArrowIcon, TweenInfo.new(0.3), {Rotation = 0}):Play()
                    DropdownFrame.Size = UDim2.new(1, 0, 0, 28)
                end
                
                local function RefreshList()
                    for _, v in pairs(DropdownList:GetChildren()) do 
                        if v:IsA("TextButton") then v:Destroy() end 
                    end
                    
                    for _, option in ipairs(Options) do
                        local ItemBtn = Instance.new("TextButton")
                        ItemBtn.Size = UDim2.new(1, 0, 0, 26)
                        ItemBtn.BackgroundColor3 = Theme.Section
                        ItemBtn.BorderSizePixel = 0
                        ItemBtn.Text = option
                        ItemBtn.TextColor3 = Theme.TextDark
                        ItemBtn.Font = Enum.Font.Gotham
                        ItemBtn.TextSize = 12
                        ItemBtn.Parent = DropdownList
                        
                        ItemBtn.MouseEnter:Connect(function()
                            ItemBtn.TextColor3 = Theme.Text
                            ItemBtn.BackgroundColor3 = Theme.Hover
                        end)
                        ItemBtn.MouseLeave:Connect(function()
                            ItemBtn.TextColor3 = Theme.TextDark
                            ItemBtn.BackgroundColor3 = Theme.Section
                        end)
    
                        ItemBtn.MouseButton1Click:Connect(function()
                            SetOption(option)
                        end)
                    end
                    DropdownList.CanvasSize = UDim2.new(0, 0, 0, #Options * 26)
                end
                
                RefreshList()

                ClickableFrame.MouseButton1Click:Connect(function()
                    isExpanded = not isExpanded
                    DropdownList.Visible = isExpanded
                    if isExpanded then
                        local h = math.min(#Options * 26, 130)
                        DropdownList.Size = UDim2.new(0.6, 0, 0, h)
                        DropdownFrame.Size = UDim2.new(1, 0, 0, 28 + h + 4)
                        TweenService:Create(ArrowIcon, TweenInfo.new(0.3), {Rotation = 180}):Play()
                    else
                        DropdownFrame.Size = UDim2.new(1, 0, 0, 28)
                        TweenService:Create(ArrowIcon, TweenInfo.new(0.3), {Rotation = 0}):Play()
                    end
                end)
                
                if Flag then Library.Flags[Flag] = selected end
                
                local DropdownObj = {}
                function DropdownObj:Set(val)
                    SetOption(val)
                end
                function DropdownObj:Refresh(newOpts)
                    Options = newOpts
                    RefreshList()
                    SetOption(Options[1] or "...")
                end
                return DropdownObj
            end
            
            function Group:AddColorPicker(config)
                local Text = config.Text or "Color Picker"
                local Default = config.Default or Color3.fromRGB(255, 255, 255)
                local Flag = config.Flag or nil
                local Callback = config.Callback or function() end
                
                table.insert(TabData[TabName].functions, "ColorPicker: " .. Text)
                
                local colorH, colorS, colorV = Default:ToHSV()
                local currentColor = Default
                
                local PickerFrame = Instance.new("Frame")
                PickerFrame.Size = UDim2.new(1, 0, 0, 28)
                PickerFrame.BackgroundTransparency = 1
                PickerFrame.Parent = Groupbox
                
                local Label = Instance.new("TextLabel")
                Label.Size = UDim2.new(1, -40, 1, 0)
                Label.BackgroundTransparency = 1
                Label.Text = Text
                Label.TextColor3 = Theme.Text
                Label.Font = Enum.Font.Gotham
                Label.TextSize = 12
                Label.TextXAlignment = Enum.TextXAlignment.Left
                Label.Parent = PickerFrame
                
                local ColorBtn = Instance.new("TextButton")
                ColorBtn.Size = UDim2.new(0, 32, 0, 20)
                ColorBtn.Position = UDim2.new(1, -34, 0.5, -10)
                ColorBtn.BackgroundColor3 = currentColor
                ColorBtn.BorderColor3 = Theme.Border
                ColorBtn.BorderSizePixel = 1
                ColorBtn.Text = ""
                ColorBtn.Parent = PickerFrame
                
                local ColorCorner = Instance.new("UICorner")
                ColorCorner.CornerRadius = UDim.new(0, 4)
                ColorCorner.Parent = ColorBtn
                
                local CP_Container = Instance.new("Frame")
                CP_Container.Size = UDim2.new(1, 0, 0, 140)
                CP_Container.Position = UDim2.new(0, 0, 1, 4)
                CP_Container.BackgroundColor3 = Theme.Section
                CP_Container.BorderColor3 = Theme.Border
                CP_Container.BorderSizePixel = 1
                CP_Container.Visible = false
                CP_Container.ClipsDescendants = true
                CP_Container.Parent = Groupbox
                
                local CPCorner = Instance.new("UICorner")
                CPCorner.CornerRadius = UDim.new(0, 6)
                CPCorner.Parent = CP_Container
                
                local SV_Map = Instance.new("ImageButton")
                SV_Map.Size = UDim2.new(0, 120, 0, 120)
                SV_Map.Position = UDim2.new(0, 10, 0, 10)
                SV_Map.BackgroundColor3 = Color3.fromHSV(colorH, 1, 1)
                SV_Map.Image = "rbxassetid://4155801252"
                SV_Map.BorderSizePixel = 0
                SV_Map.AutoButtonColor = false
                SV_Map.Parent = CP_Container
                
                local SV_Cursor = Instance.new("Frame")
                SV_Cursor.Size = UDim2.new(0, 6, 0, 6)
                SV_Cursor.AnchorPoint = Vector2.new(0.5, 0.5)
                SV_Cursor.BackgroundColor3 = Color3.new(1, 1, 1)
                SV_Cursor.BorderColor3 = Color3.new(0, 0, 0)
                SV_Cursor.BorderSizePixel = 1
                SV_Cursor.Position = UDim2.new(colorS, 0, 1 - colorV, 0)
                SV_Cursor.Parent = SV_Map
                
                local CursorCorner = Instance.new("UICorner")
                CursorCorner.CornerRadius = UDim.new(1, 0)
                CursorCorner.Parent = SV_Cursor

                local Hue_Bar = Instance.new("ImageButton")
                Hue_Bar.Size = UDim2.new(0, 20, 0, 120)
                Hue_Bar.Position = UDim2.new(0, 140, 0, 10)
                Hue_Bar.BackgroundColor3 = Color3.new(1, 1, 1)
                Hue_Bar.BorderSizePixel = 0
                Hue_Bar.AutoButtonColor = false
                Hue_Bar.Parent = CP_Container
                
                local HueCorner = Instance.new("UICorner")
                HueCorner.CornerRadius = UDim.new(0, 4)
                HueCorner.Parent = Hue_Bar
                
                local UIGradient = Instance.new("UIGradient")
                UIGradient.Rotation = 90
                UIGradient.Color = ColorSequence.new{
                    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
                    ColorSequenceKeypoint.new(0.167, Color3.fromRGB(255, 255, 0)),
                    ColorSequenceKeypoint.new(0.333, Color3.fromRGB(0, 255, 0)),
                    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
                    ColorSequenceKeypoint.new(0.667, Color3.fromRGB(0, 0, 255)),
                    ColorSequenceKeypoint.new(0.833, Color3.fromRGB(255, 0, 255)),
                    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
                }
                UIGradient.Parent = Hue_Bar
                
                local Hue_Cursor = Instance.new("Frame")
                Hue_Cursor.Size = UDim2.new(1, 4, 0, 3)
                Hue_Cursor.BackgroundColor3 = Color3.new(1, 1, 1)
                Hue_Cursor.BorderColor3 = Color3.new(0, 0, 0)
                Hue_Cursor.BorderSizePixel = 1
                Hue_Cursor.Position = UDim2.new(0, -2, colorH, 0)
                Hue_Cursor.Parent = Hue_Bar
                
                local function UpdateColorPicker()
                    currentColor = Color3.fromHSV(colorH, colorS, colorV)
                    ColorBtn.BackgroundColor3 = currentColor
                    SV_Map.BackgroundColor3 = Color3.fromHSV(colorH, 1, 1)
                    
                    if Flag then Library.Flags[Flag] = currentColor end
                    pcall(Callback, currentColor)
                end
                
                local draggingSV, draggingHue = false, false
                
                local function UpdateSV(input)
                    local rX = math.clamp(input.Position.X - SV_Map.AbsolutePosition.X, 0, SV_Map.AbsoluteSize.X)
                    local rY = math.clamp(input.Position.Y - SV_Map.AbsolutePosition.Y, 0, SV_Map.AbsoluteSize.Y)
                    
                    colorS = rX / SV_Map.AbsoluteSize.X
                    colorV = 1 - (rY / SV_Map.AbsoluteSize.Y)
                    
                    SV_Cursor.Position = UDim2.new(colorS, 0, 1 - colorV, 0)
                    UpdateColorPicker()
                end
                
                local function UpdateHue(input)
                    local rY = math.clamp(input.Position.Y - Hue_Bar.AbsolutePosition.Y, 0, Hue_Bar.AbsoluteSize.Y)
                    colorH = rY / Hue_Bar.AbsoluteSize.Y
                    
                    Hue_Cursor.Position = UDim2.new(0, -2, colorH, 0)
                    UpdateColorPicker()
                end

                SV_Map.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        draggingSV = true
                        UpdateSV(input)
                    end
                end)
                
                Hue_Bar.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        draggingHue = true
                        UpdateHue(input)
                    end
                end)
                
                UserInputService.InputChanged:Connect(function(input)
                    if draggingSV and input.UserInputType == Enum.UserInputType.MouseMovement then
                        UpdateSV(input)
                    elseif draggingHue and input.UserInputType == Enum.UserInputType.MouseMovement then
                        UpdateHue(input)
                    end
                end)
                
                UserInputService.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        draggingSV = false
                        draggingHue = false
                    end
                end)
                
                local open = false
                ColorBtn.MouseButton1Click:Connect(function()
                    open = not open
                    CP_Container.Visible = open
                end)
                
                if Flag then Library.Flags[Flag] = Default end
                
                local ColorObj = {}
                function ColorObj:Set(col)
                    colorH, colorS, colorV = col:ToHSV()
                    currentColor = col
                    SV_Cursor.Position = UDim2.new(colorS, 0, 1 - colorV, 0)
                    Hue_Cursor.Position = UDim2.new(0, -2, colorH, 0)
                    UpdateColorPicker()
                end
                return ColorObj
            end

            function Group:AddKeybind(config)
                local Text = config.Text or "Keybind"
                local Default = config.Default or Enum.KeyCode.Unknown
                local Flag = config.Flag or nil
                local Callback = config.Callback or function() end
                
                table.insert(TabData[TabName].functions, "Keybind: " .. Text)
                
                local currentKey = Default
                
                local KeybindBtn = Instance.new("TextButton")
                KeybindBtn.Size = UDim2.new(1, 0, 0, 32)
                KeybindBtn.BackgroundColor3 = Theme.Background
                KeybindBtn.BorderColor3 = Theme.Border
                KeybindBtn.BorderSizePixel = 1
                KeybindBtn.Text = Text .. ": [" .. (currentKey == Enum.KeyCode.Unknown and "..." or currentKey.Name) .. "]"
                KeybindBtn.TextColor3 = Theme.Text
                KeybindBtn.Font = Enum.Font.Code
                KeybindBtn.TextSize = 12
                KeybindBtn.Parent = Groupbox
                
                local KeyCorner = Instance.new("UICorner")
                KeyCorner.CornerRadius = UDim.new(0, 4)
                KeyCorner.Parent = KeybindBtn
                
                local function SetKey(key)
                    if CurrentKeybinds[currentKey] then CurrentKeybinds[currentKey] = nil end
                    currentKey = key
                    if key ~= Enum.KeyCode.Unknown then
                        CurrentKeybinds[currentKey] = Callback
                    end
                    KeybindBtn.Text = Text .. ": [" .. (key == Enum.KeyCode.Unknown and "..." or key.Name) .. "]"
                    
                    if Flag then Library.Flags[Flag] = currentKey end
                end
                
                local listening = false
                KeybindBtn.MouseButton1Click:Connect(function()
                    if listening then return end
                    listening = true
                    KeybindBtn.Text = Text .. ": [...]"
                    
                    local connection
                    connection = UserInputService.InputBegan:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.Keyboard then
                            SetKey(input.KeyCode)
                            listening = false
                            connection:Disconnect()
                        end
                    end)
                    
                    local escConn
                    escConn = UserInputService.InputBegan:Connect(function(input)
                        if input.KeyCode == Enum.KeyCode.Escape then
                            SetKey(Enum.KeyCode.Unknown)
                            listening = false
                            connection:Disconnect()
                            escConn:Disconnect()
                        end
                    end)
                end)
                
                if Default and Default ~= Enum.KeyCode.Unknown then
                    SetKey(Default)
                end
                
                local KeybindObj = {}
                function KeybindObj:Set(key)
                    SetKey(key)
                end
                return KeybindObj
            end
            
            function Group:AddProgressBar(config)
                local Text = config.Text or "Progress"
                local Max = config.Max or 100
                local Flag = config.Flag or nil
                
                table.insert(TabData[TabName].functions, "ProgressBar: " .. Text)
                
                local currentValue = 0
                
                local ProgressFrame = Instance.new("Frame")
                ProgressFrame.Size = UDim2.new(1, 0, 0, 38)
                ProgressFrame.BackgroundTransparency = 1
                ProgressFrame.Parent = Groupbox

                local Label = Instance.new("TextLabel")
                Label.Size = UDim2.new(1, 0, 0, 16)
                Label.BackgroundTransparency = 1
                Label.Text = Text .. ": 0/" .. Max
                Label.TextColor3 = Theme.Text
                Label.Font = Enum.Font.Gotham
                Label.TextSize = 12
                Label.TextXAlignment = Enum.TextXAlignment.Left
                Label.Parent = ProgressFrame

                local BarFrame = Instance.new("Frame")
                BarFrame.Size = UDim2.new(1, 0, 0, 10)
                BarFrame.Position = UDim2.new(0, 0, 0, 20)
                BarFrame.BackgroundColor3 = Theme.Background
                BarFrame.BorderColor3 = Theme.Border
                BarFrame.BorderSizePixel = 1
                BarFrame.Parent = ProgressFrame
                
                local ProgBarCorner = Instance.new("UICorner")
                ProgBarCorner.CornerRadius = UDim.new(1, 0)
                ProgBarCorner.Parent = BarFrame

                local Fill = Instance.new("Frame")
                Fill.Size = UDim2.new(0, 0, 1, 0)
                Fill.BackgroundColor3 = Theme.Accent
                Fill.BorderSizePixel = 0
                Fill.Parent = BarFrame
                
                local FillCorner = Instance.new("UICorner")
                FillCorner.CornerRadius = UDim.new(1, 0)
                FillCorner.Parent = Fill
                
                local PercentLabel = Instance.new("TextLabel")
                PercentLabel.Size = UDim2.new(1, 0, 1, 0)
                PercentLabel.BackgroundTransparency = 1
                PercentLabel.Text = "0%"
                PercentLabel.TextColor3 = Theme.Text
                PercentLabel.Font = Enum.Font.GothamBold
                PercentLabel.TextSize = 10
                PercentLabel.Parent = BarFrame

                local function SetValue(val)
                    currentValue = math.clamp(val, 0, Max)
                    local ratio = currentValue / Max
                    local percent = math.floor(ratio * 100)
                    
                    TweenService:Create(Fill, TweenInfo.new(0.3), {Size = UDim2.new(ratio, 0, 1, 0)}):Play()
                    
                    Label.Text = Text .. ": " .. currentValue .. "/" .. Max
                    PercentLabel.Text = percent .. "%"
                    
                    if Flag then Library.Flags[Flag] = currentValue end
                end
                
                local ProgressObj = {}
                function ProgressObj:Set(val)
                    SetValue(val)
                end
                function ProgressObj:Increment(amount)
                    SetValue(currentValue + (amount or 1))
                end
                return ProgressObj
            end
            
            return Group
        end
        return Tab
    end
    
    local SettingsTab = Window:AddTab({
        Name = "Settings",
        Icon = "lucide:settings",
        Description = "UI Configuration",
        Order = 999
    })
    
    local UISection = SettingsTab:AddGroupbox({
        Name = "UI Settings",
        Side = "Left"
    })
    
    UISection:AddButton({
        Text = "Reset UI Position",
        Callback = function()
            MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
            Library:Notify("UI", "Position reset to center", 2)
        end
    })
    
    UISection:AddButton({
        Text = "Unload UI",
        Callback = function()
            Library.Open = false
            ScreenGui:Destroy()
        end
    })

    return Window
end

return Library